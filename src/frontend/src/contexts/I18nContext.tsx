import type React from "react";
import {
  createContext,
  useCallback,
  useContext,
  useEffect,
  useState,
} from "react";

export type Language = "en" | "sw" | "ar" | "zh";

const LANG_KEY = "hey-friend-lang";

// ─── Translations ──────────────────────────────────────────────────────────────

type Translations = typeof en;

const en = {
  appName: "HEY FRIEND",
  appTagline: "Stay connected with everyone",
  nav: {
    chats: "Chats",
    contacts: "Contacts",
    notifications: "Notifications",
    settings: "Settings",
  },
  auth: {
    login: "Login",
    logout: "Logout",
    loginTitle: "Welcome to HEY FRIEND",
    loginSubtitle: "Connect with friends and family anywhere in the world",
    loginButton: "Sign in with Internet Identity",
    signingIn: "Signing in...",
  },
  registration: {
    title: "Create your profile",
    subtitle: "Set up your account to start chatting",
    phoneNumber: "Phone Number",
    phonePlaceholder: "Enter your phone number",
    countryCode: "Country Code",
    displayName: "Display Name",
    displayNamePlaceholder: "Your full name",
    gender: "Gender",
    genderMale: "Male",
    genderFemale: "Female",
    genderOther: "Other",
    address: "Address",
    addressPlaceholder: "Your city or address",
    dateOfBirth: "Date of Birth",
    profilePicture: "Profile Picture",
    uploadPhoto: "Upload Photo",
    changePhoto: "Change Photo",
    register: "Create Account",
    registering: "Creating account...",
    selectGender: "Select gender",
  },
  chat: {
    newChat: "New Chat",
    createGroup: "Create Group",
    searchChats: "Search conversations...",
    noChats: "No conversations yet",
    noChatsDesc: "Start a new chat to connect with friends",
    typeMessage: "Type a message...",
    send: "Send",
    voiceNote: "Hold to record voice note",
    attachFile: "Attach file",
    emoji: "Emoji",
    gif: "GIF",
    sticker: "Sticker",
    react: "React",
    delete: "Delete",
    copy: "Copy",
    groupName: "Group Name",
    groupNamePlaceholder: "Enter group name",
    groupDescription: "Group Description",
    groupDescPlaceholder: "What's this group about?",
    addMembers: "Add Members",
    createGroupBtn: "Create Group",
    searchUsers: "Search by name or phone",
    noResults: "No users found",
    online: "Online",
    msgStatusSent: "Sent",
    msgStatusReceived: "Received",
    msgStatusRead: "Read",
    today: "Today",
    yesterday: "Yesterday",
    members: "members",
    leaveGroup: "Leave Group",
    addMember: "Add Member",
    recording: "Recording...",
    recordingHint: "Release to send",
    cancelRecording: "Cancel",
  },
  contacts: {
    title: "Contacts",
    addContact: "Add Contact",
    searchContacts: "Search contacts...",
    noContacts: "No contacts yet",
    noContactsDesc: "Add contacts to start chatting",
    phoneNumber: "Phone Number",
    phonePlaceholder: "Enter phone number",
    label: "Contact Label",
    labelPlaceholder: "e.g. John's Work",
    save: "Save Contact",
    saving: "Saving...",
    remove: "Remove",
    message: "Message",
  },
  settings: {
    title: "Settings",
    profile: "Profile",
    editProfile: "Edit Profile",
    saveProfile: "Save Profile",
    saving: "Saving...",
    theme: "Theme",
    themeLight: "Light",
    themeDark: "Dark",
    themePink: "Pink",
    language: "Language",
    langEn: "English",
    langSw: "Swahili",
    langAr: "Arabic",
    langZh: "Chinese",
    serviceInfo: "Service & Support",
    email: "Email",
    contact: "Contact",
    version: "Version",
    logout: "Log Out",
    loggingOut: "Logging out...",
    dangerZone: "Danger Zone",
  },
  common: {
    save: "Save",
    cancel: "Cancel",
    delete: "Delete",
    confirm: "Confirm",
    loading: "Loading...",
    error: "Something went wrong",
    retry: "Retry",
    back: "Back",
    close: "Close",
    yes: "Yes",
    no: "No",
    ok: "OK",
    search: "Search",
    select: "Select",
  },
  errors: {
    loadingConversations: "Failed to load conversations",
    loadingMessages: "Failed to load messages",
    sendMessage: "Failed to send message",
    loadingContacts: "Failed to load contacts",
    registration: "Failed to create account",
  },
};

const sw: Translations = {
  appName: "HEY FRIEND",
  appTagline: "Baki ukiunganishwa na kila mtu",
  nav: {
    chats: "Mazungumzo",
    contacts: "Anwani",
    notifications: "Arifa",
    settings: "Mipangilio",
  },
  auth: {
    login: "Ingia",
    logout: "Toka",
    loginTitle: "Karibu HEY FRIEND",
    loginSubtitle: "Unganishana na marafiki na familia duniani kote",
    loginButton: "Ingia na Utambulisho wa Mtandao",
    signingIn: "Inaingia...",
  },
  registration: {
    title: "Unda wasifu wako",
    subtitle: "Weka akaunti yako kuanza kupiga gumzo",
    phoneNumber: "Nambari ya Simu",
    phonePlaceholder: "Weka nambari yako ya simu",
    countryCode: "Msimbo wa Nchi",
    displayName: "Jina la Kuonyesha",
    displayNamePlaceholder: "Jina lako kamili",
    gender: "Jinsia",
    genderMale: "Mwanaume",
    genderFemale: "Mwanamke",
    genderOther: "Nyingine",
    address: "Anwani",
    addressPlaceholder: "Mji wako au anwani",
    dateOfBirth: "Tarehe ya Kuzaliwa",
    profilePicture: "Picha ya Wasifu",
    uploadPhoto: "Pakia Picha",
    changePhoto: "Badilisha Picha",
    register: "Unda Akaunti",
    registering: "Inaunda akaunti...",
    selectGender: "Chagua jinsia",
  },
  chat: {
    newChat: "Gumzo Jipya",
    createGroup: "Unda Kikundi",
    searchChats: "Tafuta mazungumzo...",
    noChats: "Hakuna mazungumzo bado",
    noChatsDesc: "Anza gumzo jipya kuungana na marafiki",
    typeMessage: "Andika ujumbe...",
    send: "Tuma",
    voiceNote: "Shika kutuma kumbukumbu ya sauti",
    attachFile: "Ambatanisha faili",
    emoji: "Emoji",
    gif: "GIF",
    sticker: "Kibandiko",
    react: "Jibu",
    delete: "Futa",
    copy: "Nakili",
    groupName: "Jina la Kikundi",
    groupNamePlaceholder: "Weka jina la kikundi",
    groupDescription: "Maelezo ya Kikundi",
    groupDescPlaceholder: "Kikundi hiki ni kuhusu nini?",
    addMembers: "Ongeza Wanachama",
    createGroupBtn: "Unda Kikundi",
    searchUsers: "Tafuta kwa jina au simu",
    noResults: "Hakuna watumiaji waliopatikana",
    online: "Mtandaoni",
    msgStatusSent: "Imetumwa",
    msgStatusReceived: "Imepokelewa",
    msgStatusRead: "Imesomwa",
    today: "Leo",
    yesterday: "Jana",
    members: "wanachama",
    leaveGroup: "Acha Kikundi",
    addMember: "Ongeza Mwanachama",
    recording: "Inaandika...",
    recordingHint: "Acha kutuma",
    cancelRecording: "Futa",
  },
  contacts: {
    title: "Anwani",
    addContact: "Ongeza Anwani",
    searchContacts: "Tafuta anwani...",
    noContacts: "Hakuna anwani bado",
    noContactsDesc: "Ongeza anwani kuanza kupiga gumzo",
    phoneNumber: "Nambari ya Simu",
    phonePlaceholder: "Weka nambari ya simu",
    label: "Lebo ya Anwani",
    labelPlaceholder: "Mf. Kazi ya John",
    save: "Hifadhi Anwani",
    saving: "Inahifadhi...",
    remove: "Ondoa",
    message: "Ujumbe",
  },
  settings: {
    title: "Mipangilio",
    profile: "Wasifu",
    editProfile: "Hariri Wasifu",
    saveProfile: "Hifadhi Wasifu",
    saving: "Inahifadhi...",
    theme: "Mandhari",
    themeLight: "Mwanga",
    themeDark: "Giza",
    themePink: "Waridi",
    language: "Lugha",
    langEn: "Kiingereza",
    langSw: "Kiswahili",
    langAr: "Kiarabu",
    langZh: "Kichina",
    serviceInfo: "Huduma na Msaada",
    email: "Barua Pepe",
    contact: "Mawasiliano",
    version: "Toleo",
    logout: "Ondoka",
    loggingOut: "Inatoka...",
    dangerZone: "Eneo Hatari",
  },
  common: {
    save: "Hifadhi",
    cancel: "Futa",
    delete: "Futa",
    confirm: "Thibitisha",
    loading: "Inapakia...",
    error: "Kuna hitilafu",
    retry: "Jaribu tena",
    back: "Rudi",
    close: "Funga",
    yes: "Ndiyo",
    no: "Hapana",
    ok: "Sawa",
    search: "Tafuta",
    select: "Chagua",
  },
  errors: {
    loadingConversations: "Imeshindwa kupakia mazungumzo",
    loadingMessages: "Imeshindwa kupakia ujumbe",
    sendMessage: "Imeshindwa kutuma ujumbe",
    loadingContacts: "Imeshindwa kupakia anwani",
    registration: "Imeshindwa kuunda akaunti",
  },
};

const ar: Translations = {
  appName: "HEY FRIEND",
  appTagline: "ابق على تواصل مع الجميع",
  nav: {
    chats: "المحادثات",
    contacts: "جهات الاتصال",
    notifications: "الإشعارات",
    settings: "الإعدادات",
  },
  auth: {
    login: "تسجيل الدخول",
    logout: "تسجيل الخروج",
    loginTitle: "مرحباً بك في HEY FRIEND",
    loginSubtitle: "تواصل مع الأصدقاء والعائلة في كل مكان",
    loginButton: "تسجيل الدخول بالهوية الرقمية",
    signingIn: "جارٍ تسجيل الدخول...",
  },
  registration: {
    title: "إنشاء ملفك الشخصي",
    subtitle: "أنشئ حسابك لبدء المحادثة",
    phoneNumber: "رقم الهاتف",
    phonePlaceholder: "أدخل رقم هاتفك",
    countryCode: "رمز الدولة",
    displayName: "الاسم المعروض",
    displayNamePlaceholder: "اسمك الكامل",
    gender: "الجنس",
    genderMale: "ذكر",
    genderFemale: "أنثى",
    genderOther: "آخر",
    address: "العنوان",
    addressPlaceholder: "مدينتك أو عنوانك",
    dateOfBirth: "تاريخ الميلاد",
    profilePicture: "صورة الملف الشخصي",
    uploadPhoto: "رفع صورة",
    changePhoto: "تغيير الصورة",
    register: "إنشاء حساب",
    registering: "جارٍ إنشاء الحساب...",
    selectGender: "اختر الجنس",
  },
  chat: {
    newChat: "محادثة جديدة",
    createGroup: "إنشاء مجموعة",
    searchChats: "البحث في المحادثات...",
    noChats: "لا توجد محادثات بعد",
    noChatsDesc: "ابدأ محادثة جديدة للتواصل مع الأصدقاء",
    typeMessage: "اكتب رسالة...",
    send: "إرسال",
    voiceNote: "اضغط مطولاً لتسجيل مقطع صوتي",
    attachFile: "إرفاق ملف",
    emoji: "رمز تعبيري",
    gif: "GIF",
    sticker: "ملصق",
    react: "تفاعل",
    delete: "حذف",
    copy: "نسخ",
    groupName: "اسم المجموعة",
    groupNamePlaceholder: "أدخل اسم المجموعة",
    groupDescription: "وصف المجموعة",
    groupDescPlaceholder: "ما هذه المجموعة؟",
    addMembers: "إضافة أعضاء",
    createGroupBtn: "إنشاء مجموعة",
    searchUsers: "البحث بالاسم أو الهاتف",
    noResults: "لم يتم العثور على مستخدمين",
    online: "متصل",
    msgStatusSent: "مُرسَل",
    msgStatusReceived: "مُستلَم",
    msgStatusRead: "مقروء",
    today: "اليوم",
    yesterday: "أمس",
    members: "أعضاء",
    leaveGroup: "مغادرة المجموعة",
    addMember: "إضافة عضو",
    recording: "جارٍ التسجيل...",
    recordingHint: "أطلق للإرسال",
    cancelRecording: "إلغاء",
  },
  contacts: {
    title: "جهات الاتصال",
    addContact: "إضافة جهة اتصال",
    searchContacts: "البحث في جهات الاتصال...",
    noContacts: "لا توجد جهات اتصال بعد",
    noContactsDesc: "أضف جهات اتصال لبدء المحادثة",
    phoneNumber: "رقم الهاتف",
    phonePlaceholder: "أدخل رقم الهاتف",
    label: "وصف جهة الاتصال",
    labelPlaceholder: "مثل: عمل جون",
    save: "حفظ جهة الاتصال",
    saving: "جارٍ الحفظ...",
    remove: "إزالة",
    message: "رسالة",
  },
  settings: {
    title: "الإعدادات",
    profile: "الملف الشخصي",
    editProfile: "تعديل الملف الشخصي",
    saveProfile: "حفظ الملف الشخصي",
    saving: "جارٍ الحفظ...",
    theme: "المظهر",
    themeLight: "فاتح",
    themeDark: "داكن",
    themePink: "وردي",
    language: "اللغة",
    langEn: "الإنجليزية",
    langSw: "السواحيلية",
    langAr: "العربية",
    langZh: "الصينية",
    serviceInfo: "الخدمة والدعم",
    email: "البريد الإلكتروني",
    contact: "التواصل",
    version: "الإصدار",
    logout: "تسجيل الخروج",
    loggingOut: "جارٍ الخروج...",
    dangerZone: "منطقة الخطر",
  },
  common: {
    save: "حفظ",
    cancel: "إلغاء",
    delete: "حذف",
    confirm: "تأكيد",
    loading: "جارٍ التحميل...",
    error: "حدث خطأ",
    retry: "إعادة المحاولة",
    back: "رجوع",
    close: "إغلاق",
    yes: "نعم",
    no: "لا",
    ok: "حسناً",
    search: "بحث",
    select: "اختيار",
  },
  errors: {
    loadingConversations: "فشل تحميل المحادثات",
    loadingMessages: "فشل تحميل الرسائل",
    sendMessage: "فشل إرسال الرسالة",
    loadingContacts: "فشل تحميل جهات الاتصال",
    registration: "فشل إنشاء الحساب",
  },
};

const zh: Translations = {
  appName: "HEY FRIEND",
  appTagline: "随时与所有人保持联系",
  nav: {
    chats: "聊天",
    contacts: "联系人",
    notifications: "通知",
    settings: "设置",
  },
  auth: {
    login: "登录",
    logout: "退出",
    loginTitle: "欢迎来到 HEY FRIEND",
    loginSubtitle: "与世界各地的朋友和家人保持联系",
    loginButton: "使用网络身份登录",
    signingIn: "登录中...",
  },
  registration: {
    title: "创建您的个人资料",
    subtitle: "设置您的账号以开始聊天",
    phoneNumber: "手机号码",
    phonePlaceholder: "输入您的手机号码",
    countryCode: "国家代码",
    displayName: "显示名称",
    displayNamePlaceholder: "您的全名",
    gender: "性别",
    genderMale: "男",
    genderFemale: "女",
    genderOther: "其他",
    address: "地址",
    addressPlaceholder: "您的城市或地址",
    dateOfBirth: "出生日期",
    profilePicture: "头像",
    uploadPhoto: "上传照片",
    changePhoto: "更换照片",
    register: "创建账号",
    registering: "正在创建账号...",
    selectGender: "选择性别",
  },
  chat: {
    newChat: "新聊天",
    createGroup: "创建群组",
    searchChats: "搜索对话...",
    noChats: "暂无对话",
    noChatsDesc: "开始新对话以与朋友联系",
    typeMessage: "输入消息...",
    send: "发送",
    voiceNote: "长按录制语音消息",
    attachFile: "附加文件",
    emoji: "表情",
    gif: "GIF",
    sticker: "贴纸",
    react: "反应",
    delete: "删除",
    copy: "复制",
    groupName: "群组名称",
    groupNamePlaceholder: "输入群组名称",
    groupDescription: "群组描述",
    groupDescPlaceholder: "这个群组是关于什么的？",
    addMembers: "添加成员",
    createGroupBtn: "创建群组",
    searchUsers: "按姓名或电话搜索",
    noResults: "未找到用户",
    online: "在线",
    msgStatusSent: "已发送",
    msgStatusReceived: "已接收",
    msgStatusRead: "已读",
    today: "今天",
    yesterday: "昨天",
    members: "成员",
    leaveGroup: "离开群组",
    addMember: "添加成员",
    recording: "录音中...",
    recordingHint: "松开发送",
    cancelRecording: "取消",
  },
  contacts: {
    title: "联系人",
    addContact: "添加联系人",
    searchContacts: "搜索联系人...",
    noContacts: "暂无联系人",
    noContactsDesc: "添加联系人以开始聊天",
    phoneNumber: "手机号码",
    phonePlaceholder: "输入手机号码",
    label: "联系人标签",
    labelPlaceholder: "例如: 约翰的工作",
    save: "保存联系人",
    saving: "保存中...",
    remove: "删除",
    message: "消息",
  },
  settings: {
    title: "设置",
    profile: "个人资料",
    editProfile: "编辑资料",
    saveProfile: "保存资料",
    saving: "保存中...",
    theme: "主题",
    themeLight: "浅色",
    themeDark: "深色",
    themePink: "粉色",
    language: "语言",
    langEn: "英语",
    langSw: "斯瓦希里语",
    langAr: "阿拉伯语",
    langZh: "中文",
    serviceInfo: "服务与支持",
    email: "电子邮件",
    contact: "联系方式",
    version: "版本",
    logout: "退出登录",
    loggingOut: "退出中...",
    dangerZone: "危险区域",
  },
  common: {
    save: "保存",
    cancel: "取消",
    delete: "删除",
    confirm: "确认",
    loading: "加载中...",
    error: "出了些问题",
    retry: "重试",
    back: "返回",
    close: "关闭",
    yes: "是",
    no: "否",
    ok: "确定",
    search: "搜索",
    select: "选择",
  },
  errors: {
    loadingConversations: "加载对话失败",
    loadingMessages: "加载消息失败",
    sendMessage: "发送消息失败",
    loadingContacts: "加载联系人失败",
    registration: "创建账号失败",
  },
};

const translations: Record<Language, Translations> = { en, sw, ar, zh };

// ─── Context ────────────────────────────────────────────────────────────────

interface I18nContextType {
  lang: Language;
  setLang: (lang: Language) => void;
  t: Translations;
  isRTL: boolean;
}

const I18nContext = createContext<I18nContextType | undefined>(undefined);

export function I18nProvider({ children }: { children: React.ReactNode }) {
  const [lang, setLangState] = useState<Language>(() => {
    const stored = localStorage.getItem(LANG_KEY);
    if (
      stored === "en" ||
      stored === "sw" ||
      stored === "ar" ||
      stored === "zh"
    )
      return stored;
    return "en";
  });

  const setLang = useCallback((newLang: Language) => {
    setLangState(newLang);
    localStorage.setItem(LANG_KEY, newLang);
  }, []);

  const isRTL = lang === "ar";

  useEffect(() => {
    document.documentElement.dir = isRTL ? "rtl" : "ltr";
    document.documentElement.lang = lang;
  }, [lang, isRTL]);

  return (
    <I18nContext.Provider
      value={{ lang, setLang, t: translations[lang], isRTL }}
    >
      {children}
    </I18nContext.Provider>
  );
}

export function useI18n() {
  const ctx = useContext(I18nContext);
  if (!ctx) throw new Error("useI18n must be inside I18nProvider");
  return ctx;
}
